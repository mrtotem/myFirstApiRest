var express = require('express');
var user = require('./models/User');


module.exports.getUsers = function (req, res) {
	
	user.find(function(err, users){

				console.log("user");
			if(err)
				return res.send(err);

			return res.json(users);
	});
}

module.exports.registerUser = function(req, res){

		var userTemp = new user({
			firstName : req.body.firstName,
			lastName : req.body.lastName,
			dni : req.body.dni
		});
		console.log(userTemp);

		// save al usuario y checkeo de errores
		userTemp.save(function(err){
			
			if(err){

				return res.status(400).send(err);
			}else{

				console.log("after user creation");
				return res.json({ message : 'User created'}, { id : userTemp._id, firstName : userTemp.firstName, lastName : userTemp.lastName, dni : userTemp.dni});
			}
		});
}

module.exports.findUserById = function(req, res){

		user.findById(req.params._id, function(err, userTemp){

			if(err)
				return res.status(400).send(err);
	
			return res.json({ id : userTemp._id, firstName : userTemp.firstName, lastName : userTemp.lastName, dni : userTemp.dni});
		});
}

module.exports.updateUser = function(req, res){

		user.findById(req.params._id, function(err, userTemp){

			if(err)
				return res.send(err);

			userTemp.firstName = req.body.firstName;
			userTemp.lastName = req.body.lastName;
			userTemp.dni = req.body.dni;

			userTemp.save(function(err){

				if(err)
					return res.status(400).send(err);

				return res.json({message : 'User updated'}, { id : userTemp._id, firstName : userTemp.firstName, lastName : userTemp.lastName, dni : userTemp.dni});	
			});
		});
}

module.exports.deleteUser = function(req, res){

	user.remove({_id: req.params._id}, function(err, userTemp){
			
			if(err){
				return res.status(400).send(err);
			}
			return res.send({message : 'User deleted'});
	});
}